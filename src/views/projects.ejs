<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rejestr projektów - lista</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
  <div class="topbar">
    <div class="topbar-left">
      <strong>Rejestr projektów</strong>
      <span class="muted">
        | <%= user.firstName %> <%= user.lastName %> (<%= user.role === 'sales' ? 'Handlowiec' : 'Projektant' %>)
        <% if (user.role === 'sales') { %> | nr: <%= user.salesNumber %> <% } %>
      </span>
    </div>
    <div class="topbar-right">
      <% if (user.role === 'sales') { %>
        <a class="linkbtn" href="/assignments">Projektanci</a>
      <% } %>
      <form method="POST" action="/logout" style="display:inline;">
        <button class="linkbtn" type="submit">Wyloguj</button>
      </form>
    </div>
  </div>

  <div class="container">
    <% if (err) { %><div class="alert alert-err"><%= err %></div><% } %>
    <% if (msg) { %><div class="alert alert-ok"><%= msg %></div><% } %>

    <h2>Twoje projekty</h2>

    <% if (!projects.length) { %>
      <div class="card">
        <p>Brak projektów.</p>
        <% if (user.role === 'designer') { %>
          <p class="muted">Jako projektant zobaczysz projekty handlowców, gdy Cię przypiszą.</p>
        <% } %>
      </div>
    <% } else { %>
      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>Nr projektu</th>
              <th>Klient</th>
              <th>Oddział</th>
              <th>Województwo</th>
              <th>Produkt</th>
              <th>Status</th>
              <th>Obrót</th>
              <th>Miesiąc</th>
              <th>Utworzono</th>
            </tr>
          </thead>
          <tbody>
            <% projects.forEach(p => { %>
              <tr>
                <td><%= p.project_no %></td>
                <td><%= p.client_name %></td>
                <td><%= p.branch_city %></td>
                <td><%= p.voivodeship %></td>
                <td><%= p.product %></td>
                <td>
                  <%= (STATUS.find(s => s.id === p.status) || {name:'?'}).name %>
                </td>
                <td><%= p.turnover %></td>
                <td><%= p.offer_month %></td>
                <td><%= p.created_at %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <% if (user.role === 'sales') { %>
    <a class="fab" href="/projects/new">Nowy projekt</a>
  <% } %>
</body>
</html>
